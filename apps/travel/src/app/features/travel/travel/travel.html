<div class="travel-container">
  <!-- Top Navigation Bar -->
  <div class="top-nav">
    <div class="nav-left">
      <div class="trip-badges">
        <span class="badge teal">5N/6D</span>
        <span class="badge black">Flexi Package ∞</span>
      </div>
      <h1 class="trip-title">5N Goa</h1>
    </div>
    <div class="nav-right">
      <div class="budget-info">
        <div class="budget-total">
          <span class="budget-label">Budget</span>
          <span class="budget-amount">{{ formatCurrency(currentTrip?.budget?.amount || 0) }}</span>
        </div>
        <div class="budget-spent">
          <span class="budget-label">Spent</span>
          <span class="budget-amount">{{ formatCurrency(getTotalTripCost()) }}</span>
        </div>
        <div class="budget-remaining">
          <span class="budget-label">Remaining</span>
          <span class="budget-amount" [class.positive]="getBudgetRemaining() >= 0" [class.negative]="getBudgetRemaining() < 0">
            {{ formatCurrency(getBudgetRemaining()) }}
          </span>
        </div>
        <div class="budget-progress">
          <div class="progress-bar">
            <div class="progress-fill" [style.width.%]="getBudgetPercentage()"></div>
          </div>
          <span class="progress-text">{{ getBudgetPercentage() | number:'1.0-1' }}% used</span>
        </div>
      </div>
    </div>
    <div class="nav-tabs">
      <button class="tab" 
              [class.active]="isTabActive('itinerary')"
              (click)="setTab('itinerary')">ITINERARY</button>
      <button class="tab" 
              [class.active]="isTabActive('calendar')"
              (click)="setTab('calendar')">CALENDAR</button>
    </div>
  </div>

  <!-- Tab Content -->
  @if (isTabActive('itinerary')) {
    <!-- Itinerary Summary Bar -->
    <div class="summary-bar">
      <div class="summary-item" 
           [class.active]="isFilterActive('all')"
           (click)="setFilter('all')">
        <span class="count">{{ getTotalDays() }}</span>
        <span class="label">DAY PLAN</span>
      </div>
      <div class="summary-item" 
           [class.active]="isFilterActive('transfers')"
           (click)="setFilter('transfers')">
        <span class="count">{{ getTotalTransfers() }}</span>
        <span class="label">TRANSFERS</span>
      </div>
      <div class="summary-item" 
           [class.active]="isFilterActive('hotels')"
           (click)="setFilter('hotels')">
        <span class="count">{{ getTotalHotels() }}</span>
        <span class="label">HOTELS</span>
      </div>
      <div class="summary-item" 
           [class.active]="isFilterActive('activities')"
           (click)="setFilter('activities')">
        <span class="count">{{ getTotalActivities() }}</span>
        <span class="label">ACTIVITIES</span>
      </div>
      <div class="summary-item" 
           [class.active]="isFilterActive('meals')"
           (click)="setFilter('meals')">
        <span class="count">{{ getTotalMeals() }}</span>
        <span class="label">MEALS</span>
      </div>
    </div>

    <!-- Main Content Area -->
    <div class="main-content">
      <mat-accordion class="itinerary-accordion" multi>
        @for (day of currentTrip?.itinerary; track day.day) {
          <mat-expansion-panel>
                       <mat-expansion-panel-header>
               <mat-panel-title>
                                 <div class="day-header-content">
                  <div class="day-badge">Day {{ day.day }}</div>
                  <div class="day-location">{{ day.title }}</div>
                  <div class="day-weather" *ngIf="day.weather">
                    <span class="weather-icon">{{ day.weather.icon }}</span>
                    <span class="weather-temp">{{ day.weather.temperature }}°C</span>
                  </div>
                  <div class="day-date">{{ day.date | date:'MMM dd' }}</div>
                  <div class="day-cost">
                    <span class="cost-label">Day Cost</span>
                    <span class="cost-amount">{{ formatCurrency(getDayCost(day)) }}</span>
                  </div>
                </div>
               </mat-panel-title>
                            <mat-panel-description>
                  <div class="day-includes">
                    INCLUDED: {{ getDayIncludes(day) }}
                  </div>
                </mat-panel-description>
             </mat-expansion-panel-header>

                         <!-- True Chronological Timeline with Type Labels -->
              <div class="content-section">
                @for (item of getDayTimelineItems(day); track item.trackId) {
                  <!-- Transportation Item -->
                  @if (item.type === 'transportation') {
                    <div class="item-card transfer-card">
                      <div class="card-left">
                        <div class="transport-icon">
                          <mat-icon>{{ getTransportIcon(item.data.type) }}</mat-icon>
                        </div>
                      </div>
                      <div class="card-content">
                        <div class="type-label transportation-label">
                          <mat-icon>directions_car</mat-icon>
                          Transportation
                        </div>
                        <h4 class="card-title">{{ item.data.provider }}</h4>
                        <p class="card-description">{{ item.data.from }} to {{ item.data.to }}</p>
                        <div class="card-meta">
                          <span class="meta-item">
                            <mat-icon>schedule</mat-icon>
                            {{ item.data.departureTime }} - {{ item.data.arrivalTime }}
                          </span>
                          <span class="meta-item">
                            <mat-icon>timer</mat-icon>
                            {{ item.data.duration }} min
                          </span>
                          @if (item.data.cost) {
                            <span class="meta-item cost-item">
                              <mat-icon>attach_money</mat-icon>
                              {{ formatCurrency(item.data.cost.amount) }}
                            </span>
                          }
                        </div>
                      </div>
                    </div>
                  }

                  <!-- Accommodation Item -->
                  @if (item.type === 'accommodation') {
                    <div class="item-card accommodation-card">
                      <div class="card-left">
                        <img [src]="item.data.images?.[0]" [alt]="item.data.name" class="accommodation-image">
                      </div>
                      <div class="card-content">
                        <div class="type-label accommodation-label">
                          <mat-icon>hotel</mat-icon>
                          Accommodation
                        </div>
                        <h4 class="card-title">{{ item.data.name }}</h4>
                        <p class="card-description">{{ item.data.address }}</p>
                        <div class="card-meta">
                          @if (item.data.checkIn) {
                            <span class="meta-item">
                              <mat-icon>login</mat-icon>
                              Check‑in {{ item.data.checkIn }}
                            </span>
                          }
                          @if (item.data.checkOut) {
                            <span class="meta-item">
                              <mat-icon>logout</mat-icon>
                              Check‑out {{ item.data.checkOut }}
                            </span>
                          }
                          @if (item.data.cost) {
                            <span class="meta-item cost-item">
                              <mat-icon>attach_money</mat-icon>
                              {{ formatCurrency(item.data.cost.amount) }}
                            </span>
                          }
                        </div>
                      </div>
                    </div>
                  }

                  <!-- Activity Item -->
                  @if (item.type === 'activity') {
                    <div class="item-card activity-card">
                      <div class="card-left">
                        <div class="activity-icon">
                          <mat-icon>{{ getActivityIcon(item.data.type) }}</mat-icon>
                        </div>
                      </div>
                      <div class="card-content">
                        <div class="type-label activity-label">
                          <mat-icon>explore</mat-icon>
                          Activity
                        </div>
                        <h4 class="card-title">{{ item.data.title }}</h4>
                        <p class="card-description">{{ item.data.description }}</p>
                        <div class="card-meta">
                          <span class="meta-item">
                            <mat-icon>schedule</mat-icon>
                            {{ item.data.startTime }} - {{ item.data.endTime }}
                          </span>
                          <span class="meta-item">
                            <mat-icon>location_on</mat-icon>
                            {{ item.data.location }}
                          </span>
                          @if (item.data.cost) {
                            <span class="meta-item cost-item">
                              <mat-icon>attach_money</mat-icon>
                              {{ formatCurrency(item.data.cost.amount) }}
                            </span>
                          }
                        </div>
                      </div>
                    </div>
                  }
                }
              </div>
          </mat-expansion-panel>
        }
      </mat-accordion>
    </div>
  }

  @if (isTabActive('calendar')) {
    <app-calendar></app-calendar>
  }
</div>
