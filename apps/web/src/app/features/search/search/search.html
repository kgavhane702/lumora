<div class="search-page" [class.has-sessions]="hasActiveSessions">
  <!-- Initial Search Layout (First Search) -->
  <div class="initial-search-layout" *ngIf="isFirstSearch">
    <div class="search-container">
      <!-- Header -->
      <div class="search-header">
        <h1 class="brand-title">Lumora</h1>
        <p class="brand-subtitle">AI-powered search and reasoning engine</p>
      </div>

      <!-- Initial Search Bar -->
      <div class="search-bar-container">
        <app-search-bar
          #searchBar
          [placeholder]="'Ask anything...'"
          [autoFocus]="true"
          [isSearching]="isSearching"
          (search)="onSearch($event)"
          (stopSearch)="onStopSearch()"
          (fileUpload)="onFileUpload($event)">
        </app-search-bar>
      </div>

      <!-- Quick Actions -->
      <div class="quick-actions-section">
        <h3 class="section-title">Quick Actions</h3>
        <div class="quick-actions-grid">
          <button class="quick-action-card" (click)="onQuickAction('What is the latest news about AI?')">
            <div class="action-icon">
              <mat-icon>trending_up</mat-icon>
            </div>
            <div class="action-content">
              <h4>Latest AI News</h4>
              <p>Stay updated with the latest developments</p>
            </div>
          </button>
          
          <button class="quick-action-card" (click)="onQuickAction('How to learn TypeScript?')">
            <div class="action-icon">
              <mat-icon>folder</mat-icon>
            </div>
            <div class="action-content">
              <h4>Learn TypeScript</h4>
              <p>Master TypeScript programming</p>
            </div>
          </button>
          
          <button class="quick-action-card" (click)="onQuickAction('What is the weather today?')">
            <div class="action-icon">
              <mat-icon>explore</mat-icon>
            </div>
            <div class="action-content">
              <h4>Weather Today</h4>
              <p>Check current weather conditions</p>
            </div>
          </button>
          
          <button class="quick-action-card" (click)="onQuickAction('Best restaurants near me')">
            <div class="action-icon">
              <mat-icon>home</mat-icon>
            </div>
            <div class="action-content">
              <h4>Find Restaurants</h4>
              <p>Discover great places to eat</p>
            </div>
          </button>
        </div>
      </div>

      <!-- Features Section -->
      <div class="features-section">
        <h3 class="section-title">Features</h3>
        <div class="features-grid">
          <div class="feature-card">
            <div class="feature-icon">
              <mat-icon>search</mat-icon>
            </div>
            <h4>Smart Search</h4>
            <p>Get accurate answers with AI-powered search</p>
          </div>
          
          <div class="feature-card">
            <div class="feature-icon">
              <mat-icon>chat</mat-icon>
            </div>
            <h4>Conversational</h4>
            <p>Ask follow-up questions naturally</p>
          </div>
          
          <div class="feature-card">
            <div class="feature-icon">
              <mat-icon>verified</mat-icon>
            </div>
            <h4>Verified Sources</h4>
            <p>All answers come with reliable references</p>
          </div>
          
          <div class="feature-card">
            <div class="feature-icon">
              <mat-icon>speed</mat-icon>
            </div>
            <h4>Lightning Fast</h4>
            <p>Get instant answers in seconds</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Chat Layout (Subsequent Searches) -->
  <div class="chat-layout" *ngIf="hasActiveSessions">
    <!-- Navigation Menu -->
    <div class="search-nav-menu">
      <div class="nav-menu-content">
        <div class="nav-menu-left">
          <!-- Left side empty for now -->
        </div>
        
        <div class="nav-menu-right">
          <button class="nav-menu-btn" (click)="onShareResults()" matTooltip="Share Results">
            <mat-icon>share</mat-icon>
            <span>Share</span>
          </button>
          <button class="nav-menu-btn" (click)="onBookmarkResults()" matTooltip="Bookmark">
            <mat-icon>bookmark_border</mat-icon>
            <span>Bookmark</span>
          </button>
          <button class="nav-menu-btn" (click)="onExportResults()" matTooltip="Export Results">
            <mat-icon>download</mat-icon>
            <span>Export</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Main Content Area -->
    <div class="chat-content">
      <!-- Results Container -->
      <div class="results-container">
        <div class="sessions-container">
          <div
            class="session-item"
            *ngFor="let session of searchSessions; let i = index; trackBy: trackBySession"
            #currentSessionElem=""
            [attr.data-last]="i === searchSessions.length - 1 ? true : null">
            
            <div class="session-header">
              <div class="session-title">
                <h2 class="query-title">{{ session.query }}</h2>
                <div class="session-actions">
                  <button class="action-btn" title="Edit query">
                    <mat-icon>edit</mat-icon>
                  </button>
                  <button class="action-btn" title="Copy query">
                    <mat-icon>content_copy</mat-icon>
                  </button>
                </div>
              </div>
            </div>
            <div class="session-results">
              <app-search-results 
                [results]="session.results"
                [isLoading]="session.isLoading"
                (resultClick)="onResultClick($event)"
                (referenceClick)="onReferenceClick($event)"
                (followUpClick)="onFollowUpClick($event)"
                (continueSearch)="onContinueSearch($event)">
              </app-search-results>
            </div>
          </div>
        </div>
      </div>

      <!-- Search Bar Container -->
      <div class="search-bar-container">
        <app-search-bar 
          #searchBarChat
          [placeholder]="'Ask a follow-up question...'"
          [autoFocus]="false"
          [isSearching]="isSearching"
          [showAutoSuggestions]="false"
          (search)="onSearch($event)"
          (stopSearch)="onStopSearch()">
        </app-search-bar>
      </div>
    </div>
  </div>
</div>

<!-- Drag Overlay for Search Page -->
<div class="drag-overlay" *ngIf="showDragOverlay" (click)="showDragOverlay = false">
  <div class="overlay-content" (click)="$event.stopPropagation()">
    <div class="overlay-icon">
      <mat-icon>attach_file</mat-icon>
    </div>
    <div class="overlay-text">
      <h3 class="overlay-title">Drop your files here</h3>
      <p class="overlay-subtitle">Drag and drop files to attach them to your message</p>
    </div>
  </div>
</div>
