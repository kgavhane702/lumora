<aside class="sidebar" [class.mobile-open]="isMobileOpen">
  <!-- Mobile Close Button - Outside Right Edge -->
  @if (isMobileOpen) {
    <button class="mobile-close-btn" (click)="onMobileClose()">
      <mat-icon>close</mat-icon>
    </button>
  }

  <!-- Sidebar Content -->
  <div class="sidebar-content">
    <!-- Header -->
    <div class="sidebar-header">
      <div class="logo">
        <div class="logo-icon">
          <mat-icon>star</mat-icon>
        </div>
      </div>
    </div>

    <!-- New Chat Button -->
    <div class="new-chat-section">
      <button 
        class="nav-button new-chat" 
        (click)="onNewChat()"
        (mouseenter)="onIconHover()"
        (mouseleave)="onIconLeave()"
        matTooltip="Start a new conversation"
        matTooltipPosition="right"
        matTooltipClass="sidebar-tooltip">
        <mat-icon>add</mat-icon>
      </button>
    </div>

         <!-- Main Navigation -->
     <nav class="sidebar-nav">
       <!-- Main Menu -->
       <div class="nav-section">
         <a routerLink="/search" routerLinkActive="active" class="nav-item"
            (mouseenter)="onIconHover()"
            (mouseleave)="onIconLeave()">
           <mat-icon>search</mat-icon>
           <span class="menu-label">Home</span>
         </a>
       </div>

       <!-- Tools Section -->
       <div class="nav-section">
         <a routerLink="/settings" routerLinkActive="active" class="nav-item"
            (mouseenter)="onIconHover()"
            (mouseleave)="onIconLeave()">
           <mat-icon>settings</mat-icon>
           <span class="menu-label">Settings</span>
         </a>
         <a routerLink="/help" routerLinkActive="active" class="nav-item"
            (mouseenter)="onIconHover()"
            (mouseleave)="onIconLeave()">
           <mat-icon>help</mat-icon>
           <span class="menu-label">Help</span>
         </a>
       </div>

       <!-- Upgrade Section -->
       <div class="nav-section upgrade-section">
         <button 
           class="nav-button upgrade"
           (mouseenter)="onIconHover()"
           (mouseleave)="onIconLeave()"
           matTooltip="Upgrade to Lumora Pro"
           matTooltipPosition="right"
           matTooltipClass="sidebar-tooltip">
           <mat-icon>star</mat-icon>
         </button>
       </div>
     </nav>

         <!-- User Section -->
     @if (user) {
       <div class="user-section">
                   <button 
            class="user-menu-trigger"
            [matMenuTriggerFor]="userMenu"
            (mouseenter)="onIconHover()"
            (mouseleave)="onIconLeave()">
            <div class="user-avatar">
              <mat-icon>person</mat-icon>
            </div>
            <span class="menu-label">Account</span>
          </button>
         
         <mat-menu #userMenu="matMenu" class="user-dropdown-menu">
           <!-- Account Settings Section -->
           <div class="menu-section">
             <button mat-menu-item (click)="onMenuAction('account')">
               <mat-icon>person</mat-icon>
               <span>Account</span>
             </button>
             <button mat-menu-item (click)="onMenuAction('preferences')">
               <mat-icon>tune</mat-icon>
               <span>Preferences</span>
             </button>
             <button mat-menu-item (click)="onMenuAction('personalization')">
               <mat-icon>toggle_on</mat-icon>
               <span>Personalization</span>
             </button>
             <button mat-menu-item (click)="onMenuAction('tasks')">
               <mat-icon>task_alt</mat-icon>
               <span>Tasks</span>
               <div class="notification-dot"></div>
             </button>
             <button mat-menu-item (click)="onMenuAction('notifications')">
               <mat-icon>notifications</mat-icon>
               <span>Notifications</span>
             </button>
             <button mat-menu-item (click)="onMenuAction('connectors')">
               <mat-icon>hub</mat-icon>
               <span>Connectors</span>
             </button>
             <button mat-menu-item (click)="onMenuAction('pro-perks')">
               <mat-icon>favorite</mat-icon>
               <span>Pro Perks</span>
             </button>
             <button mat-menu-item (click)="onMenuAction('all-settings')">
               <mat-icon>settings</mat-icon>
               <span>All settings</span>
             </button>
           </div>
           
           <mat-divider></mat-divider>
           
           <!-- Plans Section -->
           <div class="menu-section">
             <button mat-menu-item (click)="onMenuAction('view-plans')">
               <mat-icon>description</mat-icon>
               <span>View plans</span>
             </button>
           </div>
           
           <mat-divider></mat-divider>
           
           <!-- Profile Section -->
           <div class="menu-section">
             <button mat-menu-item class="active-profile" (click)="onMenuAction('current-profile')">
               <mat-icon>person</mat-icon>
               <span>{{ user.name }}</span>
               <mat-icon class="check-icon">check</mat-icon>
             </button>
             <button mat-menu-item (click)="onMenuAction('incognito')">
               <mat-icon>incognito</mat-icon>
               <span>Incognito</span>
               <mat-icon class="info-icon">help_outline</mat-icon>
             </button>
           </div>
         </mat-menu>
       </div>
     }
  </div>

  <!-- Hover Sidebar - Sibling to sidebar-content -->
  @if (isRedSidebarVisible) {
    <div class="red-sidebar"
         (mouseenter)="onRedSidebarHover()"
         (mouseleave)="onRedSidebarLeave()">
      <div class="red-sidebar-content">
        <h3>Hover Sidebar</h3>
        <p>This sidebar appears on hover</p>
      </div>
    </div>
  }
</aside>
