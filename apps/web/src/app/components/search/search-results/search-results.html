<div class="search-results-container">
  <!-- Loading State -->
  <div class="loading-container" *ngIf="isLoading && results.length === 0">
    <div class="loading-animation">
      <div class="pulse-dots">
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
      </div>
    </div>
    <p class="loading-text">Searching for answers...</p>
    <p class="loading-subtext">This may take a few seconds</p>
  </div>

  <!-- Skeleton Loading for Results -->
  <div class="skeleton-container" *ngIf="isLoading && results.length === 0">
    <div class="skeleton-item" *ngFor="let item of [1, 2, 3]">
      <div class="skeleton-header">
        <div class="skeleton-model"></div>
        <div class="skeleton-actions">
          <div class="skeleton-action"></div>
          <div class="skeleton-action"></div>
        </div>
      </div>
      <div class="skeleton-content">
        <div class="skeleton-line"></div>
        <div class="skeleton-line"></div>
        <div class="skeleton-line short"></div>
      </div>
      <div class="skeleton-references">
        <div class="skeleton-reference" *ngFor="let ref of [1, 2]">
          <div class="skeleton-ref-title"></div>
          <div class="skeleton-ref-url"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- AI Answer Results with Tabs -->
  <div class="ai-results-list" *ngIf="!isLoading && results.length > 0">
    <div 
      class="ai-result-item" 
      *ngFor="let result of results; trackBy: trackByResult; let i = index">
      
      <!-- AI Answer Header -->
      <div class="ai-answer-header">
        <div class="ai-model-info">
          <div class="model-badge">
            <mat-icon>verified</mat-icon>
            <span class="model-name">{{ result.modelUsed }}</span>
          </div>
          <div class="confidence-indicator" *ngIf="result.confidence">
            <div class="confidence-bar">
              <div class="confidence-fill" [style.width.%]="result.confidence"></div>
            </div>
            <span class="confidence-text">{{ result.confidence }}% confident</span>
          </div>
        </div>
        
        <div class="ai-answer-actions">
          <button class="action-btn" (click)="onCopyAnswer(result)" title="Copy answer">
            <mat-icon>content_copy</mat-icon>
          </button>
          <button class="action-btn" (click)="onShareAnswer(result)" title="Share answer">
            <mat-icon>share</mat-icon>
          </button>
          <button class="action-btn" (click)="onContinueSearch(result)" title="Continue searching">
            <mat-icon>search</mat-icon>
          </button>
        </div>
      </div>

      <!-- Tab Navigation -->
      <div class="tab-navigation" *ngIf="result.references && result.references.length > 0">
        <button 
          class="tab-button" 
          [class.active]="activeTab === 'answer'"
          (click)="switchTab('answer')">
          <mat-icon>chat</mat-icon>
          <span>Answer</span>
        </button>
        <button 
          class="tab-button" 
          [class.active]="activeTab === 'sources'"
          (click)="switchTab('sources')">
          <mat-icon>link</mat-icon>
          <span>Sources ({{ result.references.length }})</span>
        </button>
      </div>

      <!-- Tab Content -->
      <div class="tab-content">
        <!-- Answer Tab -->
        <div class="tab-panel" [class.active]="activeTab === 'answer'">
          <!-- Top Sources (Limited to 4) -->
          <div class="top-sources-container" *ngIf="result.references && result.references.length > 0">
            <div class="top-sources-grid">
              <div 
                class="source-box" 
                *ngFor="let reference of result.references.slice(0, 4); trackBy: trackByReference; let i = index"
                (click)="onReferenceClick(reference)">
                <div class="source-box-content">
                  <div class="source-domain">{{ reference.domain || getDomainFromUrl(reference.url) }}</div>
                  <div class="source-title">{{ reference.title }}</div>
                  <div class="source-meta">
                    <span class="source-date" *ngIf="reference.publishedDate">{{ reference.publishedDate | date:'MMM d, y' }}</span>
                    <span class="source-relevance">Relevance: {{ reference.relevance }}%</span>
                  </div>
                </div>
                <div class="source-box-action">
                  <mat-icon>open_in_new</mat-icon>
                </div>
              </div>
            </div>
          </div>

          <!-- AI Answer Content -->
          <div class="ai-answer-content">
            <div class="answer-text" [innerHTML]="formatAnswer(result.answer)"></div>
            
            <!-- Sources Summary -->
            <div class="sources-summary" *ngIf="result.references && result.references.length > 0">
              <div class="sources-badge">
                <mat-icon>link</mat-icon>
                <span>Based on {{ result.references.length }} source{{ result.references.length > 1 ? 's' : '' }}</span>
              </div>
            </div>
          </div>

          <!-- Follow-up Questions -->
          <div class="follow-up-section" *ngIf="result.followUpQuestions && result.followUpQuestions.length > 0">
            <div class="follow-up-header">
              <h4 class="follow-up-title">
                <mat-icon>chat</mat-icon>
                Related questions
              </h4>
            </div>
            <div class="follow-up-list">
              <button 
                class="follow-up-question" 
                *ngFor="let question of result.followUpQuestions"
                (click)="onFollowUpClick(question)">
                <mat-icon>arrow_forward</mat-icon>
                <span>{{ question }}</span>
              </button>
            </div>
          </div>
        </div>

        <!-- Sources Tab -->
        <div class="tab-panel" [class.active]="activeTab === 'sources'">
          <div class="sources-tab-content">
            <div class="sources-header">
              <h4 class="sources-title">
                <mat-icon>link</mat-icon>
                All Sources ({{ result.references.length }})
              </h4>
            </div>
            
            <div class="sources-list">
              <div 
                class="source-item" 
                *ngFor="let reference of result.references; trackBy: trackByReference; let i = index"
                (click)="onReferenceClick(reference)">
                <div class="source-number">{{ i + 1 }}</div>
                <div class="source-content">
                  <div class="source-title">{{ reference.title }}</div>
                  <div class="source-url">{{ reference.url }}</div>
                  <div class="source-snippet" *ngIf="reference.snippet">{{ reference.snippet }}</div>
                  <div class="source-meta">
                    <span class="source-domain">{{ reference.domain || getDomainFromUrl(reference.url) }}</span>
                    <span class="source-date" *ngIf="reference.publishedDate">{{ reference.publishedDate | date:'MMM d, y' }}</span>
                    <span class="source-relevance">Relevance: {{ reference.relevance }}%</span>
                  </div>
                </div>
                <div class="source-action">
                  <mat-icon>open_in_new</mat-icon>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Search Metadata -->
      <div class="search-metadata" *ngIf="result.searchTime">
        <div class="metadata-item">
          <mat-icon>schedule</mat-icon>
          <span>{{ result.searchTime }}s</span>
        </div>
        <div class="metadata-item" *ngIf="result.tokenUsage">
          <mat-icon>memory</mat-icon>
          <span>{{ result.tokenUsage.total }} tokens</span>
        </div>
      </div>
    </div>
  </div>

  <!-- No Results -->
  <div class="no-results" *ngIf="!isLoading && results.length === 0">
    <div class="no-results-icon">
      <mat-icon>search</mat-icon>
    </div>
    <h3 class="no-results-title">No results found</h3>
    <p class="no-results-text">Try adjusting your search terms or ask a different question.</p>
  </div>
</div>
