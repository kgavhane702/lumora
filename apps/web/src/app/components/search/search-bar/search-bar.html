<div class="search-bar-container">
  <!-- Search Bar Container -->
  <div class="search-bar" [class.searching]="isSearching" [class.focused]="isFocused">
    <!-- Search Input with Icons -->
    <div class="search-input-container" (click)="focusSearch()">
      <!-- Input Field - Full Width -->
      <textarea 
        #searchInput
        class="search-input"
        [placeholder]="placeholder"
        [(ngModel)]="searchQuery"
        (input)="onInputChange()"
        (keydown.enter)="onEnterKey($event)"
        (keyup.escape)="clearSearch()"
        (focus)="onFocus()"
        (blur)="onBlur()"
        (keydown)="onKeyDown($event)"
        [maxlength]="maxLength"
        [disabled]="isSearching"
        autocomplete="off"
        rows="1"
        resize="none">
      </textarea>
    </div>

    <!-- Action Bar Below - All Other Icons -->
    <div class="action-bar">
      <!-- Navigation Icons -->
      <div class="nav-icons">
        <div class="search-icon" [class.active]="searchQuery">
          <app-icon name="search" [size]="18" color="#6b7280"></app-icon>
        </div>
        <div class="grid-icon">
          <app-icon name="apps" [size]="18" color="#6b7280"></app-icon>
        </div>
        <div class="help-icon">
          <app-icon name="help" [size]="18" color="#6b7280"></app-icon>
        </div>
      </div>

      <!-- Action Icons -->
      <div class="action-icons">
        <button 
          class="file-upload-btn"
          (click)="openFileUpload()"
          type="button"
          title="Upload file">
          <app-icon name="attach-file" [size]="18" color="#6b7280"></app-icon>
          <input 
            #fileInput
            type="file" 
            [accept]="acceptedFileTypes"
            (change)="onFileSelected($event)"
            style="display: none;">
        </button>
        
        <button 
          class="voice-btn"
          (click)="startVoiceInput()"
          [class.recording]="isRecording"
          type="button"
          title="Voice input">
          <app-icon name="mic" [size]="18" color="#6b7280"></app-icon>
        </button>
        
        <!-- Search/Submit Button -->
        <button 
          class="search-button"
          [class.searching]="isSearching"
          (click)="isSearching ? onStopSearch() : onSearch()"
          [disabled]="!searchQuery.trim() && !isSearching"
          type="button"
          title="Search">
          <app-icon 
            [name]="isSearching ? 'stop-circle' : 'send'" 
            [size]="22" 
            [color]="isSearching ? '#dc2626' : '#3b82f6'">
          </app-icon>
        </button>
      </div>
    </div>

    <!-- Search Suggestions - Inside search bar -->
    <div class="search-suggestions" *ngIf="showSuggestions && suggestions.length > 0">
      <div 
        class="suggestion-item" 
        *ngFor="let suggestion of suggestions; trackBy: trackBySuggestion"
        (click)="selectSuggestion(suggestion)"
        [class.selected]="selectedSuggestionIndex === suggestions.indexOf(suggestion)">
                 <app-icon 
           [name]="searchQuery.trim() ? 'search' : 'trending-up'" 
           [size]="16" 
           [color]="searchQuery.trim() ? '#6b7280' : '#3b82f6'">
         </app-icon>
        <span class="suggestion-text">{{ suggestion }}</span>
        <div class="suggestion-go">
          <app-icon name="arrow-up-left" [size]="16" color="#3b82f6"></app-icon>
        </div>
      </div>
    </div>
  </div>
